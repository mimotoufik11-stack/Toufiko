---
import '@styles/global.css';
import SiteFooter from '@components/SiteFooter.astro';
import SiteHeader from '@components/SiteHeader.astro';
import { Fragment } from 'astro/jsx-runtime';

export interface Props {
  title?: string;
  description?: string;
  structuredData?: Record<string, unknown> | null;
}

const {
  title = 'Salafi Science Network',
  description = 'Authentic Islamic knowledge curated for students of knowledge and the wider community.',
  structuredData = null
} = Astro.props;

const hasHeroSlot = Astro.slots.has('hero');
---
<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="icon" href="/favicon.svg" />
    <script is:inline>
      const STORAGE_KEY = 'ssn-theme';
      const root = document.documentElement;
      const stored = localStorage.getItem(STORAGE_KEY);
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
      const theme = stored ?? (prefersDark.matches ? 'dark' : 'light');
      root.dataset.theme = theme;
      root.classList.toggle('dark', theme === 'dark');
      const systemThemeListener = (event) => {
        if (!localStorage.getItem(STORAGE_KEY)) {
          const systemTheme = event.matches ? 'dark' : 'light';
          root.dataset.theme = systemTheme;
          root.classList.toggle('dark', systemTheme === 'dark');
        }
      };
      if (typeof prefersDark.addEventListener === 'function') {
        prefersDark.addEventListener('change', systemThemeListener);
      } else if (typeof prefersDark.addListener === 'function') {
        prefersDark.addListener(systemThemeListener);
      }
    </script>
    {structuredData && (
      <script type="application/ld+json" is:inline>{JSON.stringify(structuredData)}</script>
    )}
  </head>
  <body class="flex min-h-screen flex-col bg-[var(--color-surface)] text-[var(--color-text)]">
    <SiteHeader />
    <main class="mx-auto flex w-full max-w-6xl flex-1 flex-col gap-12 px-4 py-10 sm:px-6">
      {hasHeroSlot && (
        <section class="rounded-3xl bg-[var(--color-muted)] px-6 py-8 shadow-sm dark:bg-slate-800/70">
          <slot name="hero" />
        </section>
      )}
      <slot />
    </main>
    <SiteFooter />
  </body>
</html>
